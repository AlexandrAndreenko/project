---
- hosts: all
  become: yes
  vars:
    name_cms: "wordpress"
    name_db: "mariadb"
    name_docker_net: "wordpress-network" 
  roles:
    - docker  

  tasks:
    - name: Ð¡heck host
      shell: |
        hostname
        printf "\n"
        ip addr
      register: out
    - name: Show host
      debug:
        msg: "{{ out.stdout_lines }}"

    - name: Make sure firewalld is enabled
      systemd:
        name: firewalld
        state: started
        enabled: yes

    - name: Configure firewalld
      firewalld:
        zone: public
        service: "{{ item }}"
        state: enabled
        permanent: yes
        immediate: yes
      with_items:
        - http
        - https

    - name: Create a volume for db
      docker_volume:
        name: mariadb_data

    - name: Create a volume for httpd
      docker_volume:
        name: wordpress_data     

    - name: Copy docker-compose file
      template:
        src: docker-compose.yml
        dest: /var/lib/jenkins/
        owner: jenkins
        group: jenkins
        mode: 0644

    - name: Run docker-compose up
      shell: docker-compose up -d
      args:
        chdir: /var/lib/jenkins/
    
